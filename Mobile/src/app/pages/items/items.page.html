<ion-header class="ion-no-border">
  <ion-toolbar style="--background: transparent;">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" color="dark" icon="chevron-back-outline"
        style="background: rgba(0,0,0,0.05); border-radius: 50%; width: 40px; height: 40px; margin-left: 10px;">
      </ion-back-button>
    </ion-buttons>
    <ion-title style="font-weight: 700; color: #333; text-transform: capitalize;">
      {{ collectionName }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline"></ion-refresher-content>
  </ion-refresher>

  <div class="ion-margin-bottom animate-enter">
    <ion-searchbar 
      placeholder="Buscar..." 
      [debounce]="250" 
      (ionInput)="onSearchChange($event)"
      animated="true"
      style="--background: white; --box-shadow: 0 4px 15px rgba(0,0,0,0.05); --border-radius: 12px; padding: 0;">
    </ion-searchbar>
  </div>

  <div *ngIf="items.length > 0">
    <ion-card *ngFor="let item of items" class="animate-enter"
              style="border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.06); margin-bottom: 25px; background: white; overflow: hidden;">
      
      <div style="padding: 20px 20px 10px 20px; display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <span style="font-size: 0.7em; color: #999; background: #f4f5f8; padding: 4px 10px; border-radius: 20px; display: inline-block; margin-bottom: 5px;">
            ID: {{ item._id | slice:0:6 }}
          </span>
          <h2 style="margin: 0; font-size: 1.4em; font-weight: 700; color: #333;">
            {{ item.dynamicData['Nombre'] || item.dynamicData['Marca'] || item.name || 'Item' }}
          </h2>
        </div>
      </div>

      <ion-card-content style="padding-top: 0; padding-bottom: 10px;">
        <ion-list lines="none" style="background: transparent; padding: 0;">
          
          <ng-container *ngFor="let detail of item.dynamicData | keyvalue">
            
            <div *ngIf="(detail.value + '').startsWith('http')" style="margin-top: 15px; margin-bottom: 15px;">
              <div style="position: relative; border-radius: 16px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08);">
                <img [src]="detail.value" style="width: 100%; height: 220px; object-fit: cover; display: block;" />
                <div style="position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); color: white; padding: 4px 12px; border-radius: 8px; font-size: 0.75em; font-weight: 600;">
                  {{ detail.key }}
                </div>
              </div>
            </div>

            <ion-item *ngIf="!(detail.value + '').startsWith('http')" style="--background: transparent; --padding-start: 0; --inner-padding-end: 0; min-height: 30px; margin-bottom: 5px;">
              <ion-label style="margin: 0;">
                <p style="color: #888; font-size: 0.85em; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px;">
                  {{ detail.key }}
                </p>
                <h3 style="color: #333; font-weight: 500; font-size: 1.05em;">
                  {{ detail.value }}
                </h3>
              </ion-label>
            </ion-item>

          </ng-container>

        </ion-list>
      </ion-card-content>

      <div style="background: #f9f9fc; padding: 12px 20px; display: flex; justify-content: flex-end; gap: 15px; border-top: 1px solid #f0f0f0;">
        
        <ion-button (click)="editItem(item)" fill="clear" size="small" style="--color: var(--ion-color-primary); font-weight: 600;">
          <ion-icon name="create-outline" slot="start"></ion-icon>
          Editar
        </ion-button>

        <ion-button (click)="deleteItem(item)" fill="clear" size="small" style="--color: var(--ion-color-danger); font-weight: 600;">
          <ion-icon name="trash-outline" slot="start"></ion-icon>
          Borrar
        </ion-button>

      </div>

    </ion-card>
  </div>

  <div *ngIf="items.length === 0" class="ion-text-center ion-margin-top animate-enter" style="margin-top: 80px;">
    <div style="background: #fff; width: 120px; height: 120px; border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(0,0,0,0.05);">
      <ion-icon name="cube-outline" style="font-size: 60px; color: #ddd;"></ion-icon>
    </div>
    <h3 style="color: #555; margin-top: 25px; font-weight: 700;">Colección Vacía</h3>
    <p style="color: #999; padding: 0 40px; line-height: 1.5;">No hay nada por aquí. ¡Toca el botón + para agregar tu primer tesoro!</p>
  </div>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openCreateItemModal()" style="--background: var(--primary-gradient); box-shadow: 0 4px 15px rgba(76, 110, 245, 0.4);">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>